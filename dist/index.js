"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const dotenv = require("dotenv");
const telegraf_1 = require("telegraf");
const messages_1 = require("./messages");
dotenv.config();
const token = process.env.BOT_TOKEN;
const tgId = process.env.TG_ID;
if (!token) {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ°: Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ BOT_TOKEN Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð°.');
    process.exit(1); // Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ñ ÐºÐ¾Ð´Ð¾Ð¼ 1
}
if (!tgId) {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ°: Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ TG_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð°.');
    process.exit(1); // Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ñ ÐºÐ¾Ð´Ð¾Ð¼ 1
}
const bot = new telegraf_1.Telegraf(token);
// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð½Ð° Ð²Ð°Ñˆ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚
const forwardMessageToAdmin = (ctx, action) => __awaiter(void 0, void 0, void 0, function* () {
    var _a, _b, _c;
    try {
        const userName = ((_a = ctx.from) === null || _a === void 0 ? void 0 : _a.first_name) || 'ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾';
        const userId = ((_b = ctx.from) === null || _b === void 0 ? void 0 : _b.id) || 'ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾';
        const userUsername = ((_c = ctx.from) === null || _c === void 0 ? void 0 : _c.username)
            ? `@${ctx.from.username}`
            : 'ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾';
        const message = `ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: ${userName}\nUsername: ${userUsername}\nID: ${userId}\nÐ”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ: ${action}`;
        yield bot.telegram.sendMessage(tgId, message);
    }
    catch (error) {
        console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ:', error);
    }
});
// ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
const sendWelcomeMessage = (ctx) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    try {
        const firstName = ((_a = ctx.from) === null || _a === void 0 ? void 0 : _a.first_name) || 'Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº';
        const message = `ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, ${firstName}! 

ðŸ¤– Ð¯ Ð±Ð¾Ñ‚ ÑÐ¾Ð´Ñ€ÑƒÐ¶ÐµÑÑ‚Ð²Ð° "ÐÐ½Ð¾Ð½Ð¸Ð¼Ð½Ñ‹Ðµ ÐÐ»ÐºÐ¾Ð³Ð¾Ð»Ð¸ÐºÐ¸". Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ñ‚Ð²Ð¾Ñ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒÑÑ, ÐºÑ‚Ð¾ Ñ‚Ñ‹?

ðŸ‘‡ ÐÐ°Ð¶Ð¼Ð¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ ðŸ‘‡`;
        yield ctx.reply(message, telegraf_1.Markup.inlineKeyboard(messages_1.buttons.welcome));
        // await forwardMessageToAdmin(ctx, 'welcome');
    }
    catch (error) {
        console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:', error);
    }
});
// Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿Ð¾Ðº
const handleButtonAction = (ctx, key) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        yield ctx.deleteMessage();
        yield ctx.reply(messages_1.messages[key], telegraf_1.Markup.inlineKeyboard(messages_1.buttons[key]));
        // await forwardMessageToAdmin(ctx, key);
    }
    catch (error) {
        console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ${key}:`, error);
    }
});
// Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿Ð¾Ðº ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
messages_1.buttonKeys.welcome.forEach(key => {
    bot.action(key, (ctx) => __awaiter(void 0, void 0, void 0, function* () {
        try {
            yield handleButtonAction(ctx, key);
        }
        catch (error) {
            console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ${key}:`, error);
        }
    }));
});
// Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿Ð¾Ðº ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº
messages_1.buttonKeys.newbie.forEach(key => {
    bot.action(key, (ctx) => __awaiter(void 0, void 0, void 0, function* () {
        try {
            yield handleButtonAction(ctx, key);
        }
        catch (error) {
            console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ${key}:`, error);
        }
    }));
});
// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐÐ°Ð·Ð°Ð´" Ð´Ð»Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° Ðº Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸ÑŽ
bot.action('back_to_start', (ctx) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        yield ctx.deleteMessage();
        yield sendWelcomeMessage(ctx);
    }
    catch (error) {
        console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐÐ°Ð·Ð°Ð´":', error);
    }
}));
// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¿Ð¸ÑˆÐµÑ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð´Ñ€ÑƒÐ³Ð¾Ðµ)
bot.on('text', (ctx) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        yield sendWelcomeMessage(ctx);
    }
    catch (error) {
        console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:', error);
    }
}));
// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch().catch(error => {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð±Ð¾Ñ‚Ð°:', error);
});
console.log('Ð£Ñ€Ð°, Ð±Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!');
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
